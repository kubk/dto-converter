#!/usr/bin/env php
<?php

declare(strict_types=1);

require_once __DIR__ . '/../vendor/autoload.php';

use Riverwaysoft\DtoConverter\Ast\Converter;
use Riverwaysoft\DtoConverter\Ast\DtoVisitor;
use Riverwaysoft\DtoConverter\Bridge\Symfony\SymfonyControllerVisitor;
use Riverwaysoft\DtoConverter\ClassFilter\PhpAttributeFilter;
use Riverwaysoft\DtoConverter\Cli\ConvertCommand;
use Riverwaysoft\DtoConverter\CodeProvider\FileSystemCodeProvider;
use Riverwaysoft\DtoConverter\Language\TypeScript\TypeScriptGenerator;
use Riverwaysoft\DtoConverter\Language\UnknownTypeResolver\ClassNameTypeResolver;
use Riverwaysoft\DtoConverter\Language\UnknownTypeResolver\DateTimeTypeResolver;
use Riverwaysoft\DtoConverter\OutputDiffCalculator\OutputDiffCalculator;
use Riverwaysoft\DtoConverter\OutputWriter\SingleFileOutputWriter\SingleFileOutputWriter;
use Symfony\Component\Console\Application;
use Symfony\Component\Filesystem\Filesystem;

$application = new Application();

$application->add(
    new ConvertCommand(
        new Converter([
           new DtoVisitor(new PhpAttributeFilter('Dto')),
           new SymfonyControllerVisitor('DtoEndpoint'),
        ]),
        new TypeScriptGenerator(
            new SingleFileOutputWriter('generated.ts'),
            [
                new DateTimeTypeResolver(),
                new ClassNameTypeResolver(),
            ],
        ),
        new Filesystem(),
        new OutputDiffCalculator(),
        new FileSystemCodeProvider('/\.php$/'),
    )
);

$application->run();
